
(100 rows affected)

(100 rows affected)
For the past 5 minutes, the following are top 10 CPU consuming queries.  Stats are captured for finished queries only.  For Running queries, see next snapshot
--High CPU Queries (Delta)--
runtime                 query_hash         Total_Worker_Time_Ms Total_Logical_Reads  Total_Execution_Count Statement_Text                                                                                                                                                                                                                                                  
----------------------- ------------------ -------------------- -------------------- --------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2024-09-05 09:55:37.023 0x633034D976A3CC30                 6659               420316                    21 select * from Table1                                                                                                                                                                                                                                            
2024-09-05 09:55:37.023 0xB01BCB8ABB2C581C                   57                 2965                     1 insert into #query_stats select getdate() runtime, * from  	(SELECT query_stats.query_hash,         SUM(query_stats.total_worker_time) 'total_worker_time',  	SUM(query_stats.execution_count) 'execution_count',  	sum(total_logical_reads) 'total_logical_read
2024-09-05 09:55:37.023 0x0B2AD3959F89B3A2                   20                  580                    20 SELECT @@SERVERNAME AS logical_server_name,        DB_NAME() AS database_name,        d.database_id,        rg.logical_database_guid AS logical_database_id,        rg.physical_database_guid AS physical_database_id,        CASE rg.replica_role             W
2024-09-05 09:55:37.023 0xDC5C834B91BCBD2A                   13                  263                     1 SELECT clmns.column_id AS [ID], clmns.name AS [Name], ISNULL(dc.Name, N'') AS [DefaultConstraintName], clmns.is_nullable AS [Nullable], CAST(ISNULL(cik.index_column_id, 0) AS bit) AS [InPrimaryKey], clmns.is_identity AS [Identity], usrt.name AS [DataType],
2024-09-05 09:55:37.023 0x0D32FF7C0DC8B17C                   10                  404                     2 SELECT clmns.name AS [Name], clmns.column_id AS [ID], clmns.is_nullable AS [Nullable], clmns.is_computed AS [Computed], CAST(ISNULL(cik.index_column_id, 0) AS bit) AS [InPrimaryKey], clmns.is_ansi_padded AS [AnsiPaddingStatus], CAST(clmns.is_rowguidcol AS 
2024-09-05 09:55:37.023 0xAC7FF45EB5EE916A                    3                   46                     0 insert into #query_stats select getdate() runtime, * from  	(SELECT query_stats.query_hash,         SUM(query_stats.total_worker_time) 'total_worker_time',  	SUM(query_stats.execution_count) 'execution_count',  	sum(total_logical_reads) 'total_logical_read
2024-09-05 09:55:37.023 0x2D1CDD14D041271B                    2                    0                     1 SELECT top 10 getdate() runtime, query_hash,     		cpu_time ,  		logical_reads ,  		start_time ,  		substring (REPLACE (REPLACE ((txt.text),  CHAR(10), ' '), CHAR(13), ' '), 1, 256) AS "Statement_Text"    		from sys.dm_exec_requests req  		cross apply sys.
2024-09-05 09:55:37.023 0x53A2F8D0DF13CAA9                    0                    0                     0 SELECT dtb.name AS [Name], case when dtb.name = 'master' then ISNULL(dso.engineEdition, 5) else ISNULL(dso.engineEdition, 0) end AS [RealEngineEdition], dtb.database_id AS [ID], CAST(case when dtb.name in ('master') then 1 else dtb.is_distributor end AS bi
2024-09-05 09:55:37.023 0xD2C3BA4EA450E36D                    0                    0                     0 SELECT q.query_id  ,q.query_text_id  ,OBJECT_NAME(q.object_id) AS OBJECT_NAME  ,q.query_hash  ,qp.plan_id  ,qp.query_plan_hash  ,qt.query_sql_text  ,convert(xml,qp.query_plan) as plan_xml  ,qrs.last_execution_time  FROM sys.query_store_plan qp  INNER JOIN 
2024-09-05 09:55:37.023 0x122ECDA21C741827                    0                    0                     0 SELECT SYSUTCDATETIME() AS sample_time_utc,         @@SERVERNAME AS logical_server_name,         DB_NAME() AS database_name,         dso.database_id,         dso.elastic_pool_name,         rg.logical_database_guid AS logical_database_id,         rg.physica

(10 rows affected)
 
The following are top 10 CPU consuming queries that have not finished running at the time of this snapshot capture
--Active CPU Consuming Queries--
runtime                 query_hash         cpu_time    logical_reads        start_time              Statement_Text                                                                                                                                                                                                                                                  
----------------------- ------------------ ----------- -------------------- ----------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2024-09-05 09:55:37.067 0x633034D976A3CC30        6663               420485 2024-09-05 09:51:10.067 DECLARE @i INT = 1  				  WHILE @i <150  BEGIN  select *from Table1  SET @i +=1  END                                                                                                                                                                            
2024-09-05 09:55:37.067 0x2D1CDD14D041271B         111                 6070 2024-09-05 09:50:36.943 -- High CPU queries (that are either finished or still running)  --  if  object_id ('tempdb.dbo.#query_stats') is not null drop table #query_stats  select getdate() runtime, * into #query_stats from    (SELECT query_stats.query_hash,         SUM(query_stat
2024-09-05 09:55:37.067 NULL                       109                 6938 2024-09-05 09:49:26.160 -- High CPU queries (that are either finished or still running)  --  if  object_id ('tempdb.dbo.#query_stats') is not null drop table #query_stats  select getdate() runtime, * into #query_stats from    (SELECT query_stats.query_hash,         SUM(query_stat

(3 rows affected)
 

(100 rows affected)

(100 rows affected)
For the past 5 minutes, the following are top 10 CPU consuming queries.  Stats are captured for finished queries only.  For Running queries, see next snapshot
--High CPU Queries (Delta)--
runtime                 query_hash         Total_Worker_Time_Ms Total_Logical_Reads  Total_Execution_Count Statement_Text                                                                                                                                                                                                                                                  
----------------------- ------------------ -------------------- -------------------- --------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2024-09-05 10:00:37.080 0x633034D976A3CC30                 4866               340255                    17 select * from Table1                                                                                                                                                                                                                                            
2024-09-05 10:00:37.080 0xAC7FF45EB5EE916A                   34                 2777                     1 insert into #query_stats select getdate() runtime, * from  	(SELECT query_stats.query_hash,         SUM(query_stats.total_worker_time) 'total_worker_time',  	SUM(query_stats.execution_count) 'execution_count',  	sum(total_logical_reads) 'total_logical_read
2024-09-05 10:00:37.080 0x0B2AD3959F89B3A2                   21                  580                    20 SELECT @@SERVERNAME AS logical_server_name,        DB_NAME() AS database_name,        d.database_id,        rg.logical_database_guid AS logical_database_id,        rg.physical_database_guid AS physical_database_id,        CASE rg.replica_role             W
2024-09-05 10:00:37.080 0xAE579A5AD5051F7B                    1                  102                     1 select  top 10 t2.runtime, t2.query_hash,  	 cast((t2.total_worker_time - (case when t1.total_worker_time is null then 0 else t1.total_worker_time end)  )/1000.00 as bigint) 'Total_Worker_Time_Ms',  	 (t2.total_logical_reads - (case when t1.total_logical_r
2024-09-05 10:00:37.080 0x2D1CDD14D041271B                    1                    0                     1 SELECT top 10 getdate() runtime, query_hash,     		cpu_time ,  		logical_reads ,  		start_time ,  		substring (REPLACE (REPLACE ((txt.text),  CHAR(10), ' '), CHAR(13), ' '), 1, 256) AS "Statement_Text"    		from sys.dm_exec_requests req  		cross apply sys.
2024-09-05 10:00:37.080 0xAB8FD7BE9E25F74F                    0                  598                     1 delete #query_stats where runtime < (select max(runtime) from #query_stats)                                                                                                                                                                                     
2024-09-05 10:00:37.080 0x0E378B069701DA86                    0                    0                     0 SELECT 0 AS [Owner], ISNULL(convert(nvarchar(85), dtb.owner_sid, 1),N'') AS [Sid1] FROM sys.databases AS dtb WHERE (dtb.name=@_msparam_0)                                                                                                                       
2024-09-05 10:00:37.080 0x03CAFE308A4224AA                    0                    0                     0 SELECT tbl.name AS [Name], SCHEMA_NAME(tbl.schema_id) AS [Schema], 'Server[@Name=' + quotename(CAST(          serverproperty(N'Servername')         AS sysname),'''') + ']' + '/Database[@Name=' + quotename(db_name(),'''') + ']' + '/Table[@Name=' + quotename
2024-09-05 10:00:37.080 0x2BA3D24825B1C599                    0                    0                     0 SELECT tbl.name AS [Name], SCHEMA_NAME(tbl.schema_id) AS [Schema], 'Server[@Name=' + quotename(CAST(          serverproperty(N'Servername')         AS sysname),'''') + ']' + '/Database[@Name=' + quotename(db_name(),'''') + ']' + '/Table[@Name=' + quotename
2024-09-05 10:00:37.080 0xE4A05D6E82381885                    0                    0                     0 SELECT tbl.name AS [Name], SCHEMA_NAME(tbl.schema_id) AS [Schema], 'Server[@Name=' + quotename(CAST(          serverproperty(N'Servername')         AS sysname),'''') + ']' + '/Database[@Name=' + quotename(db_name(),'''') + ']' + '/Table[@Name=' + quotename

(10 rows affected)
 
The following are top 10 CPU consuming queries that have not finished running at the time of this snapshot capture
--Active CPU Consuming Queries--
runtime                 query_hash         cpu_time    logical_reads        start_time              Statement_Text                                                                                                                                                                                                                                                  
----------------------- ------------------ ----------- -------------------- ----------------------- ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
2024-09-05 10:00:37.363 0x633034D976A3CC30       11702               771887 2024-09-05 09:51:10.067 DECLARE @i INT = 1  				  WHILE @i <150  BEGIN  select *from Table1  SET @i +=1  END                                                                                                                                                                            
2024-09-05 10:00:37.363 0x2D1CDD14D041271B         157                 9614 2024-09-05 09:50:36.943 -- High CPU queries (that are either finished or still running)  --  if  object_id ('tempdb.dbo.#query_stats') is not null drop table #query_stats  select getdate() runtime, * into #query_stats from    (SELECT query_stats.query_hash,         SUM(query_stat

(2 rows affected)
 

Sqlcmd: Warning: The last operation was terminated because the user pressed CTRL+C.
